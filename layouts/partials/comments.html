{{- $commentsEnabled := .Params.comments | default true -}}
{{- $commentsProvider := .Site.Params.comments.provider | default "giscus" -}}

{{- if $commentsEnabled }}
<div class="comments-section" id="comments">
    <h2>Comentários</h2>
    
    {{- if eq $commentsProvider "giscus" }}
    {{- $repo := .Site.Params.comments.giscus.repo | default "" -}}
    {{- $repoId := .Site.Params.comments.giscus.repoId | default "" -}}
    {{- $category := .Site.Params.comments.giscus.category | default "General" -}}
    {{- $categoryId := .Site.Params.comments.giscus.categoryId | default "" -}}
    
    {{- if and $repo $repoId }}
    <script src="https://giscus.app/client.js"
            data-repo="{{ $repo }}"
            data-repo-id="{{ $repoId }}"
            data-category="{{ $category }}"
            data-category-id="{{ $categoryId }}"
            data-mapping="pathname"
            data-strict="0"
            data-reactions-enabled="1"
            data-emit-metadata="0"
            data-input-position="bottom"
            data-theme="preferred_color_scheme"
            data-lang="pt"
            crossorigin="anonymous"
            async>
    </script>
    {{- else }}
    <p class="comments-notice">Comentários não configurados. Configure o Giscus em <code>hugo.toml</code>.</p>
    {{- end }}
    
    {{- else if eq $commentsProvider "utterances" }}
    {{- $repo := .Site.Params.comments.utterances.repo | default "" -}}
    
    {{- if $repo }}
    <script src="https://utteranc.es/client.js"
            repo="{{ $repo }}"
            issue-term="pathname"
            theme="preferred-color-scheme"
            crossorigin="anonymous"
            async>
    </script>
    {{- else }}
    <p class="comments-notice">Comentários não configurados. Configure o Utterances em <code>hugo.toml</code>.</p>
    {{- end }}
    
    {{- else if eq $commentsProvider "custom" }}
    <div class="custom-comments">
        {{- .Site.Params.comments.customHTML | safeHTML }}
    </div>
    {{- end }}
</div>
{{- end }}

